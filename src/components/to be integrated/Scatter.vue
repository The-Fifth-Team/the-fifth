<template>
    <div>
        <h1>Scatter</h1>
        <p>Clusters :  {{ clusters() }} </p>
        <p>Noise : {{ noise() }} </p>
        <p>Colors : {{ assignColors() }} </p>
        <canvas ref="myCanvas" ></canvas>

    </div>
</template>

<script>
import Chart from 'chart.js';
var clustering = require('density-clustering');
var PCA = require('pca-js');

export default {
    name: 'Scatter',

    data() {
        return {
            
            dataFromBack: [{},{}],// will be imported from back
            // dataset: [
            //     [0.00007120907685020939, 0.9996920824050903, 0.0002362711529713124, 2.8879677316240304e-8, 2.0808808898209463e-8, 1.7259198159536027e-7, 3.059259867654873e-8],
            //     [0.000042652260162867606, 0.9998913407325745, 0.00006600304914172739, 1.683484240899702e-9, 1.4342901866193358e-10, 9.389207633603291e-9, 1.4288694671904523e-9],
            //     [0.0019169851439073682, 0.9967482686042786, 0.0013113765744492412, 0.0000038106747979327338, 1.1958245238474774e-7, 0.000019136290575261228, 3.390661333924072e-7],
            //     [0.9853368997573853, 0.005658261477947235, 0.004198487848043442, 0.003424427704885602, 8.201746481972805e-7, 0.0013271839125081897, 0.0000539578431926202],
            //     [0.9996863007545471, 0.0002541517314966768, 0.000009998284440371208, 0.000002820821009663632, 1.0564946140156906e-10, 0.000001022489414026495, 0.00004569689554045908],
            //     [0.9326173663139343, 0.06725820153951645, 0.0000018694217942538671, 0.000004092488779861014, 1.6435254546198763e-10, 0.0000026759091724670725, 0.00011587401968427002],
            //     [3.4858405228987976e-7, 1, 1.0593659283131274e-9, 1.8497516851567752e-9, 1.4326207050090883e-13, 1.9950439078542104e-9, 9.670834133501671e-10],
            //     [7.421108727534431e-10, 1, 1.583410486061254e-11, 1.0844611320059983e-10, 6.7754647200860235e-16, 3.2841407544836887e-12, 3.4238157014393478e-12],
            //     [6.805797170272854e-7, 0.9999990463256836, 2.1489025670007322e-8, 6.669603180853301e-8, 2.574971052354824e-12, 4.089049987499038e-9, 2.807620802514066e-10],
            //     [0.020588692277669907, 0.9787845015525818, 0.000008923598215915263, 0.0000896608762559481, 1.6185700246751367e-7, 0.00013919177581556141, 0.0003889337240252644],
            //     [0.09335001558065414, 0.06294599920511246, 0.00003723329791682772, 0.5202749967575073, 0.00006382029823726043, 0.00028671708423644304, 0.32304129004478455],
            //     [0.1310638189315796, 0.42970970273017883, 0.00008260733011411503, 0.1608160138130188, 0.00000959571661951486, 0.007887031883001328, 0.270431250333786],
            //     [0.0034386436454951763, 0.9833908677101135, 0.000016480518752359785, 0.007402757182717323, 1.4356311339724925e-7, 0.00034214614424854517, 0.005408957600593567],
            //     [1.4510780488308228e-7, 1, 2.0674606471260404e-10, 1.8108838040209463e-10, 1.3278174243244322e-15, 5.75029746041622e-10, 1.0387829485480893e-10],
            //     [0.000004935193828714546, 0.999995231628418, 8.32164281927561e-10, 2.3943287352778952e-9, 2.158042252114068e-14, 1.228861066238096e-7, 1.1760555029827202e-10],
            //     [0.9479790329933167, 0.051113370805978775, 0.000005530827820621198, 0.00017727710655890405, 4.490257499156769e-9, 0.0006244227406568825, 0.0001001255659502931],
            //     [0.982110857963562, 0.017832430079579353, 0.0000049042337195714936, 0.000045835753553546965, 1.1245787634450721e-10, 0.000004753799657919444, 0.0000010366891274316004],
            //     [0.9275623559951782, 0.07243582606315613, 1.516208527618801e-7, 0.0000016830833828862524, 4.907867732009685e-13, 3.2010213146804745e-8, 1.587300175742712e-7],
            //     [7.789524580914531e-11, 1, 4.262389323873156e-13, 3.713867321314401e-12, 1.4794088859563948e-17, 1.3571204706894213e-12, 8.572110035687253e-13],
            //     [3.53572698896798e-10, 1, 6.685512560222762e-11, 1.1393915672064381e-10, 4.6008898459733855e-14, 1.0460388631672313e-11, 3.390531952418563e-11],
            //     [0.000155568472109735, 0.9998445510864258, 1.7146120967481693e-8, 6.345995018364192e-8, 9.334479261595419e-14, 2.853506657629623e-7, 4.809315612419596e-9],
            //     [0.07372605800628662, 0.9262099266052246, 0.000009926069651555736, 0.000037363850424299017, 1.4246141766260934e-10, 0.000016528872947674245, 3.8024970194783236e-7],
            //     [0.9834687113761902, 0.004859346896409988, 0.003455407451838255, 0.007481973152607679, 3.2412813766313775e-8, 0.0007247235043905675, 0.000009982605661207344],
            //     [0.00023104212596081197, 0.9997649788856506, 0.0000011958908316955785, 0.0000010820634770425386, 5.750723008901559e-9, 0.0000011464886711110012, 4.1981957110692747e-7],
            //     [8.713471970622777e-7, 0.9999990463256836, 2.5270472381322406e-9, 6.847259470532663e-8, 5.313438924958724e-12, 7.43738297614982e-8, 9.121690069946453e-9],
            //     [1.4498777289873033e-8, 1, 9.316698523775813e-10, 3.8325628781699095e-10, 5.87084742799393e-13, 7.657123823889833e-10, 7.034538229699905e-11],
            //     [0.999996153027344, 0.0000025417459710297408, 8.563499909186589e-10, 3.059826170215274e-9, 8.228086181144567e-13, 1.4908296819271527e-10, 0.0000015363057173090056]
            // ],
            //colors: ['black', 'red', 'blue', 'green', 'orange', 'yellow', 'indigo', 'navy'],
            
            dbscan : new clustering.DBSCAN(),
            
       }
    },

    methods: {
        drawChart() {
            new Chart(this.$refs.myCanvas, {
                type: 'scatter',
                data: {
                    datasets: [{
                        label: 'Scatter Dataset',
                        pointBackgroundColor: this.assignColors(),//['black','red','blue','orange','yellow','indigo'],//// array of colors(a string)
                        data: this.pairs(),
                    }]
                },
                options: {
                    responsive: true,
                    legend: {
                        display: true,
                    },
                    title: {
                        display: true,
                        text: 'Chart.js Scatter Plot Chart'
                    },
                    scales: {
                        xAxes: [{
                            type: 'linear',
                            position: 'bottom',
                            // ticks: {
                            //     stepSize: 500
                            // },
                            scaleLabel: {
                                display: true,
                                labelString: 'PCA 1',
                                fontSize:20,
                                padding:6
                            }
                        }],
                        yAxes: [{
                            type: 'linear',
                            scaleLabel: {
                                display: true,
                                labelString: 'PCA 2',
                                fontSize:20,
                                padding:6
                            }
                        }]
                    }
                }
            })
        },

        clusters() {
            return this.dbscan.run(this.transformBackData(), 0.01, 2)
        },

        noise() {
            return this.dbscan.noise
        },

        vectors() {
            return PCA.getEigenVectors(this.transformBackData())
        },

        adData() {
            return PCA.computeAdjustedData(this.transformBackData(),this.vectors()[0],this.vectors()[1])["adjustedData"]
        },

        pairs() {
            var xs = this.adData()[0];
            var ys = this.adData()[1];
            var xAndYs = [];

            for (let i = 0; i < xs.length; i++) {
                xAndYs.push({x:xs[i]+0.5, y:ys[i]+0.5})
            }

            return xAndYs
        },

        assignColors() {
            var clusters = this.clusters();
            var noise = this.noise();
            var colors = [];
            var matchedColors = {
                noise: 'red',
                clus0: 'blue',
                clus1: 'orange',
                clus2: 'green',
                clus3: 'yellow',
                clus4: 'indigo',
                clus5: 'purple',
                clus6: 'navy'             
            }
            
            for (let i= 0; i < this.transformBackData().length; i++) {

                if(noise.includes(i)) {
                    colors[i] = matchedColors["noise"]
                } else {
                    for (let j = 0; j < clusters.length; j++) {
                        var theCluster = "clus" + j ;
                        if(clusters[j].includes(i)) {
                            colors[i] = matchedColors[theCluster]  
                        }
                    }
                }
                         
            }    
            return colors
        },

        transformBackData() {
            var dataset = [];
            this.dataFromBack.forEach(obj => {
                dataset.push([obj["neutral"], obj["happy"], obj["sad"], obj["angry"], obj["fearful"], obj["disgusted"], obj["surprised"]])
            })
            return dataset
        }
    },

    mounted() {
        this.drawChart();
        //this.assignColors()
    },

    // created() {
    //   this.data1 = this.pairs(this.adData())  
      
    // }

}
</script>

<style scoped>
    canvas {
        max-width:1000px;
    }
</style>